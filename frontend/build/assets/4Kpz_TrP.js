import"./BKQlMBgy.js";let r=!0;const a=document.getElementById("mic");let m=!1;const A=document.getElementById("log"),C=document.getElementById("log-wrapper"),b=document.getElementById("log-c"),B=document.getElementById("setting"),f=document.getElementById("account");async function S(e){return{success:!0}}a.addEventListener("click",async()=>{a.disabled=!0,r=!r,(await S()).success&&setTimeout(()=>{r?(a.classList.remove("mic-on"),a.classList.add("mic-off")):(a.classList.remove("mic-off"),a.classList.add("mic-on")),a.disabled=!1},500)});A.addEventListener("click",()=>{m?C.classList.remove("log-open"):C.classList.add("log-open"),m=!m});window.addEventListener("load",async()=>{const n=await(await fetch("./data/example/log.json")).json();n.sort((t,c)=>c.time-t.time),n.forEach(t=>{const c=document.createElement("div"),d=document.createElement("p"),l=document.createElement("span"),g=document.createElement("span");c.className="message",l.className="timestamp",g.className="content";const i=new Date(t.time),y=`${i.getFullYear()}/${String(i.getMonth()+1).padStart(2,"0")}/${String(i.getDate()).padStart(2,"0")} ${String(i.getHours()).padStart(2,"0")}:${String(i.getMinutes()).padStart(2,"0")}`;l.textContent=`[${y}] `,g.textContent=t.message,d.appendChild(l),d.appendChild(g),c.appendChild(d),b.appendChild(c)})});B.addEventListener("click",()=>{location.href="./setting.html"});f.addEventListener("click",()=>{location.href="./account_setting.html"});const I=document.getElementById("btnStart"),p=document.getElementById("status"),u=document.getElementById("player");let s,o=null;function G(e){if(o){try{URL.revokeObjectURL(o)}catch{}o=null}const n=URL.createObjectURL(e);o=n,u.src=n,u.play().catch(t=>{console.warn("play() failed:",t)}),u.onended=()=>{if(o){try{URL.revokeObjectURL(o)}catch{}o=null}}}I.onclick=async()=>{s||(s=new WebSocket("ws://localhost:8765"),s.binaryType="blob",s.onopen=()=>{p.textContent="接続中！",I.disabled=!0,a.disabled=!1,w(s)},s.onmessage=e=>{if(typeof e.data=="string"){JSON.parse(e.data);return}else{const n=e.data;G(n)}},s.onclose=()=>{p.textContent="接続終了",I.disabled=!1,a.disabled=!0})};async function w(e){const n=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new AudioContext({sampleRate:16e3});await t.audioWorklet.addModule(new URL("data:text/javascript;base64,Ly8g44Gd44Gu44G+44G+IDEyOCDjgrXjg7Pjg5fjg6so4omIOG1zQDE2aykgSW50MTYg44KSIHBvc3RNZXNzYWdlCmNsYXNzIEF1ZGlvUHJvY2Vzc29yIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29yIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLnNlcSA9IDA7CiAgfQogIHByb2Nlc3MoaW5wdXRzKSB7CiAgICBjb25zdCBjaCA9IGlucHV0c1swXTsKICAgIGlmIChjaCAmJiBjaFswXSAmJiBjaFswXS5sZW5ndGgpIHsKICAgICAgY29uc3QgZjMyID0gY2hbMF07CiAgICAgIGNvbnN0IHBjbSA9IG5ldyBJbnQxNkFycmF5KGYzMi5sZW5ndGgpOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGYzMi5sZW5ndGg7IGkrKykgewogICAgICAgIGxldCB2ID0gZjMyW2ldOwogICAgICAgIGlmICh2ID4gMSkgdiA9IDE7CiAgICAgICAgaWYgKHYgPCAtMSkgdiA9IC0xOwogICAgICAgIHBjbVtpXSA9IHYgKiAzMjc2NzsKICAgICAgfQogICAgICB0aGlzLnBvcnQucG9zdE1lc3NhZ2UocGNtLCBbcGNtLmJ1ZmZlcl0pOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQp9CnJlZ2lzdGVyUHJvY2Vzc29yKCJhdWRpby1wcm9jZXNzb3IiLCBBdWRpb1Byb2Nlc3Nvcik7Cg==",import.meta.url));const c=t.createMediaStreamSource(n),d=new AudioWorkletNode(t,"audio-processor");d.port.onmessage=l=>{e.readyState===WebSocket.OPEN&&e.send(l.data.buffer)},c.connect(d)}
